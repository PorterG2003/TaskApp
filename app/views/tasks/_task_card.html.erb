<div class="px-6 py-3 bg-white/30 hover:bg-white/40 transition duration-150" data-controller="task">
  <!-- Task Header -->
  <div class="flex items-start gap-4">
    <!-- Completion Checkbox -->
    <%= form_with model: task, local: false, data: { action: "submit->task#toggle", turbo_method: :patch } do |form| %>
      <%= form.hidden_field :completed, value: !task.completed? %>
      <button type="submit" class="flex-shrink-0">
        <% if task.completed? %>
          <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
            <i class="fas fa-check text-gray-900"></i>
          </div>
        <% else %>
          <div class="w-6 h-6 border-2 border-gray-300 rounded-full hover:border-green-400 transition duration-150"></div>
        <% end %>
      </button>
    <% end %>

    <!-- Task Content -->
    <div class="min-w-0 flex-1">
      <!-- Title and Badges -->
      <div class="flex flex-wrap items-center gap-2">
        <h4 class="<%= 'line-through text-gray-500' if task.completed? %> text-lg font-medium text-gray-900 truncate">
          <%= task.title %>
        </h4>
        
        <!-- Priority Badge -->
        <%= render Ui::Badge.new(
          text: task.priority_label,
          variant: task.priority_color_variant,
          size: :sm
        ) %>
        
        <!-- Overdue Badge -->
        <% if task.overdue? %>
          <%= render Ui::Badge.new(
            text: "Overdue",
            variant: :danger,
            size: :sm
          ) %>
        <% end %>
      </div>

          <!-- Task Details -->
    <% if task.description.present? && !task.calendar_event_id.present? %>
      <p class="<%= 'text-gray-400' if task.completed? %> text-gray-600 mt-1 break-words line-clamp-2">
        <%= task.description %>
      </p>
    <% end %>

    <!-- Due Date (only show for non-calendar tasks) -->
    <% if task.due_date.present? && !task.calendar_event_id.present? %>
      <p class="text-sm text-gray-500 mt-2 flex items-center">
        <i class="fas fa-calendar text-gray-500 mr-1 flex-shrink-0"></i>
        <span class="truncate">Due: <%= task.due_date.strftime("%B %d, %Y") %></span>
      </p>
    <% end %>
    </div>

    <!-- Actions Dropdown -->
    <div class="relative flex-shrink-0" data-controller="dropdown">
      <button class="text-gray-500 hover:text-gray-700 p-2 transition duration-200"
              data-action="dropdown#toggle">
        <i class="fas fa-ellipsis-h"></i>
      </button>
      
      <!-- Dropdown Menu -->
      <div class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 py-1 hidden z-10"
           data-dropdown-target="menu">
        <%= link_to edit_task_path(task), 
            class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition duration-150" do %>
          <i class="fas fa-edit w-4 h-4 mr-3"></i>
          <span>Edit Task</span>
        <% end %>
        
        <%= link_to task_path(task),
            class: "flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition duration-150",
            data: { 
              turbo_method: :delete,
              turbo_confirm: "Are you sure you want to delete this task?"
            } do %>
          <i class="fas fa-trash w-4 h-4 mr-3"></i>
          <span>Delete Task</span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Task Details -->
  <div class="mt-2 ml-10">
    <% if task.description.present? %>
      <p class="<%= 'text-gray-400' if task.completed? %> text-gray-600 break-words line-clamp-2"><%= task.description %></p>
    <% end %>
  
    <% if task.due_date.present? %>
      <p class="text-sm text-gray-500 mt-2 flex items-center">
        <i class="fas fa-calendar text-gray-500 mr-1 flex-shrink-0"></i>
        <span class="truncate">Due: <%= task.due_date.strftime("%B %d, %Y") %></span>
      </p>
    <% end %>
  </div>
</div>